name: Tests
on:
    push:
        branches:
            - main
    pull_request:
    workflow_dispatch:
jobs:
    ruff:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: ["3.10", "3.13"]
        name: ruff on ${{ matrix.python-version }}
        steps:
            - uses: actions/checkout@v4
            - uses: astral-sh/setup-uv@v3
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - uses: actions/setup-python@v5
              with:
                  python-version-file: "pyproject.toml"
            - run: uv sync --all-extras --dev
            - run: uv run ruff check .

    mypy:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: ["3.10", "3.13"]
        name: mypy on ${{ matrix.python-version }}
        steps:
            - uses: actions/checkout@v4
            - uses: astral-sh/setup-uv@v3
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - uses: actions/setup-python@v5
              with:
                  python-version-file: "pyproject.toml"
            - run: uv sync --all-extras --dev
            - run: uv run mypy .

    ruff-format:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: ["3.10", "3.13"]
        name: ruff-format on ${{ matrix.python-version }}
        steps:
            - uses: actions/checkout@v4
            - uses: astral-sh/setup-uv@v3
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - uses: actions/setup-python@v5
              with:
                  python-version-file: "pyproject.toml"
            - run: uv sync --all-extras --dev
            - run: uv run ruff format --check .

    pytest:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: ["3.10", "3.13"]
        name: pytest on ${{ matrix.python-version }}
        steps:
            - uses: actions/checkout@v4
            - uses: astral-sh/setup-uv@v3
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - uses: actions/setup-python@v5
              with:
                  python-version-file: "pyproject.toml"
            - run: uv sync --all-extras --dev
            - run: uv run pytest

    doctest:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: ["3.10", "3.13"]
        name: doctest on ${{ matrix.python-version }}
        steps:
            - uses: actions/checkout@v4
            - uses: astral-sh/setup-uv@v3
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - uses: actions/setup-python@v5
              with:
                  python-version-file: "pyproject.toml"
            - run: uv sync --all-extras --dev
            - run: uv run make -C docs doctest
